@model List<_10X_ManagerPortal.Models.ReportModel>

@{
    ViewBag.Title = "Reports Library";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    th {
        text-transform: none !important
    }
</style>

<link rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

<div class="card shadow bg-transparent border border-primary p-4 mt-4">

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
        <div>
            <h4 class="card-title mb-1">Reports Library</h4>
            <p class="text-muted">Retail & ERP reports driven by SAP B1 HANA & Crystal Reports</p>
        </div>

        @*<div class="btn-group ms-md-auto mt-3 mt-md-0" role="group">
            <button type="button" class="btn btn-outline-primary active">Retail Reports</button>
            <button type="button" class="btn btn-outline-primary">ERP Reports</button>
        </div>*@
    </div>
    <!--<div class="d-flex flex-wrap gap-2 mb-4">

        <select class="form-select w-auto">
            <option selected>Today</option>
            <option value="1">Yesterday</option>
            <option value="2">Last 7 Days</option>
            <option value="3">Custom Range</option>
        </select>

        <select class="form-select w-auto">
            <option selected>All Stores</option>
            <option value="1">Store 01</option>
            <option value="2">Store 02</option>
        </select>

        <button class="btn btn-primary">Run Report</button>-->
    @*<button class="btn btn-outline-danger">Export</button>*@
    <!--</div>-->
    <!-- Reports Table -->
    <div class="table-responsive">
        <table id="reportsTable" class="display compact table table-striped">
            <thead>
                <tr>
                    <th>Report Name</th>
                    <th class="d-none">QString</th>
                    <th class="d-none">IntrnlKey</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td class="fw-semibold">@item.QName</td>

                        <!-- Hidden SQL Query -->
                        <td class="d-none qstring">@item.QString</td>
                        <td class="d-none report-id">@item.IntrnlKey</td>   <!-- important -->


                        <td class="text-end">
                            <button class="btn btn-sm btn-outline-primary preview-btn">
                                Preview
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section scripts {

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {

            $('#reportsTable').DataTable({
                paging: true,
                searching: true,
                info: true,
                lengthChange: false,
                scrollY: '300px',
                scrollCollapse: true,
                ordering: true

            });
        });

        //// Preview click
        //$(document).on("click", ".preview-btn", function () {

        //    // get hidden QString
        //    var qString = $(this).closest("tr").find(".qstring").text().trim();

        //    // Redirect to controller
        //    window.location.href = "/Reports/Preview?query=" +
        //        encodeURIComponent(qString);
        //});
     
      
    $(document).on("click", ".preview-btn", function () {

        var id = $(this).closest("tr").find(".report-id").text().trim();

        var url = '@Url.Action("Preview", "Reports")' + '?id=' + id;

        window.location.href = url;
    });
  


    </script>

}
